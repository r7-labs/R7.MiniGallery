@inherits DotNetNuke.Web.Mvc.Framework.DnnWebViewPage<IList<R7.MiniGallery.ViewModels.ImageViewModel>>

@using System.Collections.Generic
@using DotNetNuke.Collections
@using DotNetNuke.Web.Mvc.Helpers
@using DotNetNuke.Web.Client.ClientResourceManagement
@using DotNetNuke.Framework.JavaScriptLibraries
@using DotNetNuke.Common.Utilities

@{
    JavaScript.RequestRegistration ("React");
    JavaScript.RequestRegistration ("ReactDOM");
    JavaScript.RequestRegistration ("BlueimpGallery");
    ClientResourceManager.RegisterScript (Dnn.DnnPage, "~/DesktopModules/MVC/R7.MiniGallery/js/minigallery.min.js");
    ClientResourceManager.RegisterStyleSheet (Dnn.DnnPage, "~/Resources/Libraries/BlueimpGallery/02_25_00/css/blueimp-gallery.min.css");
}

<div class="minigallery2"
    data-module-id="@Dnn.ModuleContext.ModuleId"
    data-images="@Model.ToJson()">
</div>
@section scripts
{
    @if (Model.Count > 0) {
    <script type="text/javascript">
   
    (function ($, window, document) {
    	$(() => {
            $(".minigallery2").each ((i, el) => {
                console.log ($(el).data ("images"));
            	ReactDOM.render(
                    React.createElement (BlueimpGallery, {
                        ModuleId: $(el).data ("module-id"),
	                    Images: $(el).data ("images")
	                }, null), el
                );
    	    });

	        // TODO: Move to jsx
            $("#dnn_ctr" + "@Dnn.ModuleContext.ModuleId" + "_ModuleContent .links a.MG_Link").click (function (event) {
                event = event || window.event;
                var target = event.target || event.srcElement,
                    link = target.src ? target.parentNode : target,
                    options = {
                        index: link,
                        event: event,
                        container: "#lightbox-@Dnn.ModuleContext.ModuleId"
                    },
                    links = $(this).closest(".links").find("a.MG_Link");
                blueimp.Gallery(links, options);
            });
    	});
	}) (jQuery, window, document);
    </script>
    }
}
